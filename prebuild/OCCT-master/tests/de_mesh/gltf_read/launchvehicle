puts "========"
puts "0031706: Data Exchange, RWGltf_CafReader - imports model with incorrect transformation"
puts "========"

ReadGltf D [locate_data_file bug31706_launchvehicle.glb]
XGetOneShape s D
checknbshapes s -face 9 -compound 22
checktrinfo s -tri 47640 -nod 35270

if { [XDumpLocation D 0:1:1:22:5] != "Transformation (3 rows * 4 columns matrix): (1,0,0,0) (0,1,0,-3350) (0,0,1,-2700)" } {
  puts "Error: wrong location of D:Root/CentaurBody/Fairing1"
}
if { [XDumpLocation D 0:1:1:22:6] != "Transformation (3 rows * 4 columns matrix): (-1,-0,-1.50996e-07,0) (0,1,0,8000) (1.50996e-07,0,-1,0)" } {
  puts "Error: wrong location of D:Root/CentaurBody/FairingFlipper_180_Y"
}
if { [XDumpLocation D 0:1:1:29:1] != "Transformation (3 rows * 4 columns matrix): (1,0,0,0) (0,1,0,-11350) (0,0,1,-2700)" } {
  puts "Error: wrong location of D:Root/CentaurBody/FairingFlipper_180_Y/Fairing2"
}

set THE_REF_DUMP {
ASSEMBLY COMPOUND 0:1:1:1 "Root"
	INSTANCE COMPOUND 0:1:1:1:1 (refers to 0:1:1:2) "Booster"
	INSTANCE COMPOUND 0:1:1:1:2 (refers to 0:1:1:22) "CentaurBody"
	INSTANCE FACE 0:1:1:1:3 (refers to 0:1:1:31) "InterstageAdapter"
ASSEMBLY COMPOUND 0:1:1:2 "Booster"
	INSTANCE COMPOUND 0:1:1:2:1 (refers to 0:1:1:3) "BoosterEng2_Parent"
	INSTANCE COMPOUND 0:1:1:2:2 (refers to 0:1:1:7) "BoosterEngine1"
	INSTANCE COMPOUND 0:1:1:2:3 (refers to 0:1:1:8) "SRB_1_Parent"
	INSTANCE COMPOUND 0:1:1:2:4 (refers to 0:1:1:11) "SRB_2_Parent"
	INSTANCE COMPOUND 0:1:1:2:5 (refers to 0:1:1:13) "SRB_3_Parent"
	INSTANCE COMPOUND 0:1:1:2:6 (refers to 0:1:1:15) "SRB_4_Parent"
	INSTANCE COMPOUND 0:1:1:2:7 (refers to 0:1:1:17) "SRB_5_Parent"
	INSTANCE COMPOUND 0:1:1:2:8 (refers to 0:1:1:19) "SRB_6_Parent"
	INSTANCE FACE 0:1:1:2:9 (refers to 0:1:1:21) "BoosterMesh"
ASSEMBLY COMPOUND 0:1:1:3 "BoosterEng2_Parent"
	INSTANCE COMPOUND 0:1:1:3:1 (refers to 0:1:1:4) "BoosterEngine2"
ASSEMBLY COMPOUND 0:1:1:4 "BoosterEngine2"
	INSTANCE FACE 0:1:1:4:1 (refers to 0:1:1:5) "Flame_Booster2"
	INSTANCE FACE 0:1:1:4:2 (refers to 0:1:1:6) "BoosterEngineMesh"
PART FACE 0:1:1:5 "LongFlameMesh"
PART FACE 0:1:1:6 "BoosterEngineMesh"
ASSEMBLY COMPOUND 0:1:1:7 "BoosterEngine1"
	INSTANCE FACE 0:1:1:7:1 (refers to 0:1:1:5) "Flame_Booster1"
	INSTANCE FACE 0:1:1:7:2 (refers to 0:1:1:6) "BoosterEngineMesh"
ASSEMBLY COMPOUND 0:1:1:8 "SRB_1_Parent"
	INSTANCE COMPOUND 0:1:1:8:1 (refers to 0:1:1:9) "SRB1"
ASSEMBLY COMPOUND 0:1:1:9 "SRB1"
	INSTANCE FACE 0:1:1:9:1 (refers to 0:1:1:5) "SRB_Flame1"
	INSTANCE FACE 0:1:1:9:2 (refers to 0:1:1:10) "SRBMesh"
PART FACE 0:1:1:10 "SRBMesh"
ASSEMBLY COMPOUND 0:1:1:11 "SRB_2_Parent"
	INSTANCE COMPOUND 0:1:1:11:1 (refers to 0:1:1:12) "SRB2"
ASSEMBLY COMPOUND 0:1:1:12 "SRB2"
	INSTANCE FACE 0:1:1:12:1 (refers to 0:1:1:5) "SRB_Flame2"
	INSTANCE FACE 0:1:1:12:2 (refers to 0:1:1:10) "SRBMesh"
ASSEMBLY COMPOUND 0:1:1:13 "SRB_3_Parent"
	INSTANCE COMPOUND 0:1:1:13:1 (refers to 0:1:1:14) "SRB3"
ASSEMBLY COMPOUND 0:1:1:14 "SRB3"
	INSTANCE FACE 0:1:1:14:1 (refers to 0:1:1:5) "SRB_Flame3"
	INSTANCE FACE 0:1:1:14:2 (refers to 0:1:1:10) "SRBMesh"
ASSEMBLY COMPOUND 0:1:1:15 "SRB_4_Parent"
	INSTANCE COMPOUND 0:1:1:15:1 (refers to 0:1:1:16) "SRB4"
ASSEMBLY COMPOUND 0:1:1:16 "SRB4"
	INSTANCE FACE 0:1:1:16:1 (refers to 0:1:1:5) "SRB_Flame4"
	INSTANCE FACE 0:1:1:16:2 (refers to 0:1:1:10) "SRBMesh"
ASSEMBLY COMPOUND 0:1:1:17 "SRB_5_Parent"
	INSTANCE COMPOUND 0:1:1:17:1 (refers to 0:1:1:18) "SRB5"
ASSEMBLY COMPOUND 0:1:1:18 "SRB5"
	INSTANCE FACE 0:1:1:18:1 (refers to 0:1:1:5) "SRB_Flame5"
	INSTANCE FACE 0:1:1:18:2 (refers to 0:1:1:10) "SRBMesh"
ASSEMBLY COMPOUND 0:1:1:19 "SRB_6_Parent"
	INSTANCE COMPOUND 0:1:1:19:1 (refers to 0:1:1:20) "SRB6"
ASSEMBLY COMPOUND 0:1:1:20 "SRB6"
	INSTANCE FACE 0:1:1:20:1 (refers to 0:1:1:5) "SRB_Flame6"
	INSTANCE FACE 0:1:1:20:2 (refers to 0:1:1:10) "SRBMesh"
PART FACE 0:1:1:21 "BoosterMesh"
ASSEMBLY COMPOUND 0:1:1:22 "CentaurBody"
	INSTANCE COMPOUND 0:1:1:22:1 (refers to 0:1:1:23) "CentaurEngine1"
	INSTANCE COMPOUND 0:1:1:22:2 (refers to 0:1:1:25) "CentaurEngine2_Parent"
	INSTANCE FACE 0:1:1:22:3 (refers to 0:1:1:27) "CentaurFuelPump1"
	INSTANCE FACE 0:1:1:22:4 (refers to 0:1:1:27) "CentaurFuelPump2"
	INSTANCE FACE 0:1:1:22:5 (refers to 0:1:1:28) "Fairing1"
	INSTANCE COMPOUND 0:1:1:22:6 (refers to 0:1:1:29) "FairingFlipper_180_Y"
	INSTANCE FACE 0:1:1:22:7 (refers to 0:1:1:30) "CentaurBodyMesh"
ASSEMBLY COMPOUND 0:1:1:23 "CentaurEngine1"
	INSTANCE FACE 0:1:1:23:1 (refers to 0:1:1:5) "Centaur_Flame1"
	INSTANCE FACE 0:1:1:23:2 (refers to 0:1:1:24) "CentaurEngineMesh"
PART FACE 0:1:1:24 "CentaurEngineMesh"
ASSEMBLY COMPOUND 0:1:1:25 "CentaurEngine2_Parent"
	INSTANCE COMPOUND 0:1:1:25:1 (refers to 0:1:1:26) "CentaurEngine2"
ASSEMBLY COMPOUND 0:1:1:26 "CentaurEngine2"
	INSTANCE FACE 0:1:1:26:1 (refers to 0:1:1:5) "Centaur_Flame2"
	INSTANCE FACE 0:1:1:26:2 (refers to 0:1:1:24) "CentaurEngineMesh"
PART FACE 0:1:1:27 "CentuarFuelPumpMesh"
PART FACE 0:1:1:28 "FairingMesh"
ASSEMBLY COMPOUND 0:1:1:29 "FairingFlipper_180_Y"
	INSTANCE FACE 0:1:1:29:1 (refers to 0:1:1:28) "Fairing2"
PART FACE 0:1:1:30 "CentaurBodyMesh"
PART FACE 0:1:1:31 "AdapterMesh"

Free Shapes: 1
ASSEMBLY COMPOUND  0:1:1:1 "Root"
}
checkXDump D $THE_REF_DUMP
